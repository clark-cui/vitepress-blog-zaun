---
title: DeFi科普
description: DeFi基础知识
aside: false
date: 2022-05-01
tags:
  - 区块链
---
## 什么是 DeFi

DeFi 是 Decentralized Finance 的缩写，也就是去中心化金融，大概意思就是把一些传统的金融产品复制到了区块链上，比如给 makerDao 这个 DApp,用户可以用它通过质押自己的数字资产，然后获得收益，整个流程通过智能合约控制。
但是也不仅仅是传统金融，还要打通区块链和现实世界，所以就有了合成资产（Synthetic Assets）和语言机(Oracle)。

### 合成资产

简单来讲，就是抵押一种现实资产从而获得另一种在链上的资产。比如美元是现实资产，稳定币 USDT 就是泰达公司通过抵押美元而得到的合成资产。通过这个工具，我们可以把现实资产映射到链上。

### 预言机

它是把现实世界的数据传输到区块链上的通道。许多 DeFi 智能合约的运转需要现实数据输入。比如上面提到 makerDao 就需要获取以太坊的实时价格。有了预言机，DeFi 才能和现实世界互通。

### DeFi 的优势与劣势

DeFi 有透明，去中心化，能 24h 交易，没有中间商赚差价的优势。但是，因为 DeFi 的透明机制，智能合约的代码是开源的，也就更容易被黑客攻击。

## EVM 是什么

是 Ethereum Virtual Machine 的缩写，翻译过来就是以太坊虚拟机，是一种虚拟机，用来运行智能合约代码。以太坊上有许多的智能合约，在满足条件后就会自动执行。之所以需要虚拟机，是因为节点的环境不同，为了保证智能合约运行结果的一致，所以需要一个虚拟机，统一合约代码的运行环境。okc 上也上了 evm，所以 eth 上的智能合约都能轻松地在 okc 上部署

## NFT 是什么

是 Non-Fungible Tokens 的缩写，翻译为非同质化通证。非同质化对应同质化，比特币就是同质化通证，比如，我的一枚比特币与小张的一枚比特币没有任何区别，同时，我也能把自己的一枚比特币分割成 10 份，每份 0.1 枚。而非同质化通证却不是，每个 NFT 都有一个独特且唯一的标识，不可复制，最小单位是 1，不可分割。

### 如何使用 NFT

把图片上传到 NFT 平台，填写资产说明，并连接钱包，智能合约会生成一份代表这个图片所有权的 NFT 通证，并发送到你的钱包地址，然后就可以在这个平台把这个 NFT 上架拍卖。之后的每一次转卖，作者都会获得一定比例的分成。

### NFT 的应用

不只是图片，各种数字产品都可以。还可以把一份收藏品分成很多份，每一份生成 1 个 NFT，这样就可以大大降低准入门槛。

## DeFi 是如何帮你借贷的

DeFi 借贷，是将借贷协议用智能合约自动执行，通过协议来匹配借方和贷方，在质押确认后及时划转资产。

1. 最火热的流动池模式
   DeFi 借贷系统相当一一个公开透明，自动运营的资金池，资金池中的水是加密资产，用户存入、归还加密资产时就相当于有水流汇入，用户取出存款或借款时，就有水流出。
   你存入加密资产后，会有一个 aToken，就跟存折一样，当你决定取款时，向 DeFi 系统归还取款凭证，就可以收回原来存入的资产并获得收益。另外，你还可以把这个存款凭证 aToken 放在二级市场交易。
   在借款时，要向 DeFi 系统抵押，并且要超额抵押，假设最低抵押率是 150%，那么想要借 100 元就要抵押 150 元的存款凭证，这是为了确保资金池不会因为借款而枯竭。另外，当你以加密资产 A 作为抵押，借出加密资产 B，当币价波动，A 的价格下降或者 B 的价格上升时，抵押率就会下降，为了保证借出去的加密资产 B 始终有足额担保，DeFi 系统设置了清算过程，它设定了一个清算值（也是百分比），当抵押率低于这个清算值时，DeFi 系统会触发清算，并将你抵押的部分加密资产 A 冻结拍卖，这个时候其他人可以用折扣价，用加密资产 B 买下这部分抵押物，相当于系统帮你做了偿还的操作，与此同时，系统会对你收取罚金作为处罚。

2. 闪电贷
   可以在不卖出加密资产的前提下，借出我们急需的加密资产。但超额质押的机制，限制了我们的资金利用率，所以有了无抵押贷款——闪电贷，条件是在同一区块链交易结束前进行偿还，不然这个借贷就不被承认。举个例子，你使用 1 次共享单车，视为 1 次区块链交易，在你扫码开锁时，可以向单车平台借一笔款，期间你可以随意使用这笔钱，当骑行结束关锁时，你必须向平台还款。

优点是过程透明简单，没有繁琐的审核，任何人都能借贷。缺点是智能合约代码开源，容易被黑客抓住漏洞进行攻击，损失无法挽回。基 eth 协议的 DeFi 借贷手续费较高，链上拥堵时有发生，降低用户体验，极端情况下会导致借款人来不及补充抵押物而遭到清算。

## 什么是去中心化交易所

中心化交易所（CEX）：单个买方和卖方难以匹配，所以需要一个撮合平台，以挂单的形式，平台根据价格和时间来均衡排序，帮助买卖双方的匹配

去中心化交易所（DEX）：Decentralized Exchange 的缩写。有人探索把交易所放在链上，于是诞生了 Dex。通过智能合约进行订单撮合，并进行交易结算，交易的全部流程也都会通过智能合约记录到区块链上。

早期的去中心化交易所，会把买卖双方的挂单存储在区块链上的订单簿上，并在区块链上进行撮合和交易结算。卖方填写订单请求，并用私钥签名后提交到区块链上锁定，买方在挂单中进行选择，确认后，由智能合约对这两者的交易需求进行匹配，交易成功后在链上进行结算。也就是说，交易时，挂单、交易结算、提现等操作都是由智能合约在链上完成的，也就意味着交易时需要时间等待的步骤（在区块链上被矿工确认），而且需要给矿工支付 Gas 费，最后导致又慢又贵，体验很差。

第二代去中心化交易所，开始把为买卖双方匹配最佳订单的撮合过程放在链下，只把最后的撮合结果提交到区块链上，由智能合约完成最后的结算。这种链下订单簿的模式，减少了链上确认的频次，但依然不能满足即时交易的需求，也在一定程度上牺牲了去中心化的优势。

新的去中心化交易所，引入了 AMM（Automated market maker）机制，也就是自动做市商模式，它直接根据算法，计算出两个或几个资产之间的汇率，买卖双方不再进行订单匹配，而是通过智能合约和流动性资金池进行交易。举个例子，一个 AMM 菜市场，有一个台子，左边是一堆大米，右边是一堆钱，中间是一个机器人。卖大米的人来了，他只要把自己的大米放在左边，机器人根据函数计算出价格，并告诉他可以从右边拿走多少钱。买大米的人来了，他只要把钱放在右边，机器人会根据函数计算结果，告诉他可以从左边拿走多少大米。这样就实现了不用挂单等待的即时交易。Uniswap 就是这么干的。

去中心化交易所，不需要开户和身份核验就能使用，也不用将资产托管给交易所，资产安全更有保障。但是缺点是链上交易受到区块链网络性能的影响，AMM 机制解决了去中心化交易所链上交易不足，流动性差的问题，但也带来了滑点、无偿损失的问题。

### 关于 AMM 自动化做市商的一切

它根据算法，计算出几个资产之间的汇率，用户根据汇率来兑换资产， 流动性资金池是其中的关键。你只需要把自己的加密资产按比例投入流动性池中，就可以为他提供流动性。流动性资金池越大，大家的交易就越方便。
为了激励大家提供流动性，有些项目方会给流动性提供者分发项目的治理代币，这就是流动性挖矿。你可以参与流动性挖矿赚取收益，但这并不是稳赚不赔的生意，你还要小心滑点和无偿损失。
AMM 模式的交易所，汇率计算是其中的要点，它的原理是一个函数，以 uniswap 为例，它使用的函数是 x *y=k,x 和 y 分表代表了不同资产在交易所中的数量，k 是约定好的常数。初始阶段，uniswap 两个兑换池的资金价值相等，举个例子，假设苹果和梨都是 1 元，初始有 10 个苹果，10 个梨，所以 k=x *y=10 *10=100,对于任何交易，uniswap 都要保证池中的苹果 *香蕉=100。所以当你卖 1 个苹果给 uniswap,池子里就有了 11 个苹果，为了保证 k=100，所以池子里香蕉的数量就是 9.09，那么相当于你卖出 1 个苹果，得到了 0.91 个香蕉。以前，1 个苹果能换 1 个香蕉，现在 1 个苹果却只换到了 0.91 个香蕉，这少拿走的 0.09 个香蕉，就是滑点导致的。这也是这个公式的缺点，当一个币对池，其中一个币被卖入的越多，那这个币就越便宜，同理，被买走的越多就越贵。滑点与交易池的大小有关，比如刚才的例子，如果是 100 个苹果，100 个香蕉，那么拿 1 个苹果就能换 0.99 个香蕉，滑点是 0.01。
然而市场上币价波动性大，假如市场上苹果价格不断上涨，然而这个流动性池中苹果的价格还是相对比较便宜的，所以就会有人不断地在流动性池中充入香蕉换取苹果来套利。
假设还是之前那个 10 *10 的模型，苹果的市场价格涨到了 5 元，香蕉仍然是 1 元。所以就有人在这个过程中不断用香蕉换苹果套利，然后池子里就剩下 5 个苹果，20 个香蕉，k 还是 100。此时池子里的价值是 5 *5+20 *1=45 元。假设池子的流动性都是你添加的，相当于你参加了流动性挖矿，那么你的资产价值就是 45 元。但如果你不参与流动性挖矿，你原来的 10 个苹果，10 个香蕉都还在，那么此时价值就是 10 *5+10 \*1=60 元，参与流动性挖矿反倒赚的少了，这 15 美元的差价就是无常损失。uniswap 的无常损失情况可以通过曲线图快速知晓（losses to liquidity providers due to price variation）,展示了价格变化多少时，无偿损失会有多少。

不同的去中心化交易所，会选择不同的函数来减少滑点和无偿损失。
